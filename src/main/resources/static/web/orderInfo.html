<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<!--edge浏览器H5兼容设置-->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!--360浏览器H5兼容设置-->
		<meta name="renderer" content="webkit" />
		<title>电脑商城</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!--导入核心文件-->
		<script src="../static/bootstrap3/js/holder.js"></script>
		<link href="../static/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
		<script src="../static/bootstrap3/jquery-1.9.1.min.js"></script>
		<script src="../static/bootstrap3/js/bootstrap.js"></script>
		<!-- 字体图标 -->
		<link rel="stylesheet" href="../static/bootstrap3/font-awesome-4.7.0/css/font-awesome.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/layout.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/top.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/footer.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/orderInfo.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/order.css" />

		<link rel="stylesheet" type="text/css" href="../static/css/font-awesome1.min.css">
		<link rel="stylesheet" type="text/css" href="../static/css/style.css">
		<script src="../static/js/error.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/TimeTran.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/jquery-getUrlParam.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			$(function (){
				$(".header").load("template/head.html")
				$(".footer").load("template/footer.html")
				$(".middleBar").load("template/middleBar.html")
			})
			
			$(function (){
				getOrderVO()
			})

		</script>
	</head>

	<body>
		<!--头部-->
		<header class="header"></header>
		<!--导航 -->
		<!--分割导航和顶部-->
		<div class="middleBar"></div>
		<!--头部结束-->
		<!--导航结束-->
		<!--页面主体开始-->
		<div class="container" id="orderInfo">
			<div class="col-md-offset-1 col-md-10">
				<h1>订单详情：</h1>
				<h2 class="page-header">状态信息：</h2>
				<div class="state-bar">
					订单号：1101000301 ，当前状态：等待收货
				</div>
				<ol class="order-flow">
					<li class="order-success">1.提交订单 <small>2018-12-2 20:32:17</small> <span class="fa fa-check-circle"></span></li>
					<li class="order-success">2.付款成功 <small>2018-12-2 20:35:03</small> <span class="fa fa-check-circle"></span></li>
					<li class="order-success">3.商城发货 <small>2018-12-3 08:13:34</small> <span class="fa fa-check-circle"></span></li>
					<li>4.用户收货</li>
					<li>5.购物评价</li>
				</ol>
				<h2 class="page-header">地址详情：</h2>
				<p>收货人姓名：八戒，邮政编码：100190，联系电话： 1380***1234</p>
				<p>收货地址：北京市房山区高老庄3排6号</p>
				<h2 class="page-header">物流信息：</h2>
				<p>发货时间：2018-12-3 08:13:34</p>
				<p>物流公司：顺丰快递</p>
				<p>快递单号：301111303203048</p>
				<p>物流信息：</p>
				<p>2018-12-3 08:13:34 您的快递在【北京国贸分拣中心】分拣完毕</p>
				<p>2018-12-3 08:39:50 您的快递在【北京国贸分拣中心】准备装车</p>
				<p>2018-12-3 12:20:07 您的快递到达【北京中关村分拣中心】</p>
				<h2 class="page-header">商品详情：</h2>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">
               			订单号：1101000301，下单时间：2018-12-2 20:32:17 ， 收货人：八戒
            			</h3>
					</div>
					<div class="panel-body">
						<table class="orders-table">
							<thead>
								<tr>
									<th width="15%"></th>
									<th width="35%">商品</th>
									<th width="15%">单价</th>
									<th width="15%">数量</th>
									<th width="20%">小计</th>
								</tr>
							</thead>
							<tbody class="orders-body">
								<tr>
									<td><img src="../static/images/portal/12DELLXPS13-silvery/collect.png" class="img-responsive" /></td>
									<td>联想(Lenovo)小新Air13 Pro 13.3英寸14.8mm超轻薄笔记本电脑</td>
									<td>¥<span>5298</span></td>
									<td>1件</td>
									<td>¥<span>5298</span></td>
								</tr>
							</tbody>
						</table>
						<div>
							<span class="pull-right">订单总金额：¥5298</span>
						</div>
					</div>
				</div>
				<a href="orders.html">返回</a>
			</div>
		</div>
		<!--页脚开始-->
		<div class="clearfix"></div>
		<footer class="footer"></footer>
		<!--页脚结束-->
		<script type="text/javascript">
			function setStatus(status){
				let str = ""
				switch (status){
					case 0: str = "等待付款"; break
					case 1: str = "等待收货"; break
					case 2: str = "订单已取消"; break
					case 3: str = "订单已超时"; break
					case 4: str = "订单已完成"; break
					default: confirm("订单状态错误")
				}
				return str
			}

			function setOption(status){
				let str = ""
				if(status === "等待付款"){
					str = "去付款"
				}
				return str
			}

			function setMall(str){
				let mall = '<li>3.商城发货</li>'
				if(str === "等待收货"){
					mall =  '<li class="order-success">3.商城发货 <small>#{sendTime}</small> <span class="fa fa-check-circle"></span></li>'
				}
				return mall
			}

			function setLogInfo(str){
				let logInfo = ""
				if(str === "等待收货"){
					logInfo = '<h2 class="page-header">物流信息：</h2>' +
							'<p>发货时间：#{sendTime}</p>' +
							'<p>物流公司：顺丰快递</p>' +
							'<p>快递单号：3011113032030#{oid}</p>' +
							'<p>物流信息：</p>' +
							'<p>#{sendTime1} 您的快递在【#{provinceName}国贸分拣中心】分拣完毕</p>' +
							'<p>#{sendTime2} 您的快递在【#{provinceName}国贸分拣中心】准备装车</p>' +
							'<p>#{sendTime3} 您的快递到达【#{provinceName}#{cityName}分拣中心】</p>'
				}
				return logInfo
			}
			function operation(oid){

			}
			function getOrderVO(){
				let oid = $.getUrlParam("oid")
				$.ajax({
					url: "/order/get_orderVO",
					type: "post",
					data: {
						"oid": oid
					},
					dataType: "json",
					success: function (json){
						if(json.state === 200){
							let orderVO = json.data
							let dv = '<div class="col-md-offset-1 col-md-10">' +
									'<h1>订单详情：</h1>' +
									'<h2 class="page-header">状态信息：</h2>' +
									'<div class="state-bar">' +
									'订单号：11010003#{oid} ，当前状态：#{status}' +
									'</div>' +
									'<ol class="order-flow">' +
									'<li class="order-success">1.提交订单 <small>#{createTime}</small> <span class="fa fa-check-circle"></span></li>' +
									'<li class="order-success">2.付款成功 <small>#{payTime}</small> <span class="fa fa-check-circle"></span></li>' +
									'#{mall}' +
									'<li>4.用户收货</li>' +
									'<li>5.购物评价</li>' +
									'</ol>' +
									'<h2 class="page-header">地址详情：</h2>' +
									'<p>收货人姓名：#{name}，邮政编码：#{zip}，联系电话：#{phone}</p>' +
									'<p>收货地址：#{address}</p>' +
									'#{logInfo}' +
									'<h2 class="page-header">商品详情：</h2>' +
									'<div class="panel panel-default">' +
									'<div class="panel-heading">' +
									'<h3 class="panel-title">' +
									'订单号：11010003#{oid}，下单时间：#{createTime}， 收货人：#{name}' +
									'</h3>' +
									'</div>' +
									'<div class="panel-body">' +
									'<table class="orders-table">' +
									'<thead>' +
									'<tr>' +
									'<th width="15%"></th>' +
									'<th width="35%">商品</th>' +
									'<th width="15%">单价</th>' +
									'<th width="15%">数量</th>' +
									'<th width="20%">小计</th>' +
									'</tr>' +
									'</thead>' +
									'<tbody class="orders-body" id=#{tbId}>' +
									'</tbody>' +
									'</table>' +
									'<div>' +
									'<a class="pull-right" style="cursor: pointer; color: #72ACE3" id=#{opId} onclick="operation(#{oid})">#{option}</a>' +
									'<span class="pull-right" style="padding: 0 15px;">订单总金额：¥<label style="color: red">#{totalPrice}</label>元</span>' +
									'</div>' +
									'</div>' +
									'</div>' +
									'<a href="orders.html" style="cursor: pointer; color: #72ACE3">返回</a>' +
									'</div>'

							dv = dv.replace(/#{oid}/g, oid)
							let str = setStatus(orderVO.status)
							let mall = setMall(str)
							let logInfo = setLogInfo(str)
							let option = setOption(str)
							dv = dv.replace(/#{mall}/g, mall)
							dv = dv.replace(/#{option}/g, option)
							dv = dv.replace(/#{logInfo}/g, logInfo)
							dv = dv.replace(/#{status}/g, str)
							let orderTime = getDate(orderVO.orderTime)
							dv = dv.replace(/#{createTime}/g, orderTime)
							let payTime = getDate(orderVO.orderTime)
							dv = dv.replace(/#{payTime}/g, payTime)
							let sendTime = setTime(orderVO.orderTime, "sendTime")
							dv = dv.replace(/#{sendTime}/g, sendTime)
							dv = dv.replace(/#{name}/g, orderVO.recvName)
							dv = dv.replace(/#{zip}/g, orderVO.zip)
							dv = dv.replace(/#{phone}/g, orderVO.phone)
							let address = orderVO.provinceName+orderVO.cityName+orderVO.areaName+orderVO.address
							dv = dv.replace(/#{address}/g, address)
							dv = dv.replace(/#{sendTime}/g, sendTime)
							let sendTime1 = setTime(orderVO.orderTime, "sendTime1")
							let sendTime2 = setTime(orderVO.orderTime, "sendTime2")
							let sendTime3 = setTime(orderVO.orderTime, "sendTime3")
							dv = dv.replace(/#{sendTime1}/g, sendTime1)
							dv = dv.replace(/#{provinceName}/g, orderVO.provinceName)
							dv = dv.replace(/#{sendTime2}/g, sendTime2)
							dv = dv.replace(/#{sendTime3}/g, sendTime3)
							dv = dv.replace(/#{cityName}/g, orderVO.cityName)
							dv = dv.replace(/#{totalPrice}/g, orderVO.totalPrice)
							let tbId = "tb" + oid.toString()
							dv = dv.replace(/#{tbId}/g, tbId)
							$("#orderInfo").html(dv)
							let list = orderVO.orderItems
							for (let i = 0; i < list.length; i++){
								let tr = '<tr>' +
										'<td><img src="..#{image}collect.png" class="img-responsive" /></td>' +
										'<td>#{title}</td>' +
										'<td>¥<span>#{price}</span></td>' +
										'<td>#{num}件</td>' +
										'<td>¥<span>#{subPrice}</span></td>' +
										'</tr>'
								tr = tr.replace(/#{image}/g, list[i].image)
								tr = tr.replace(/#{title}/g, list[i].title)
								tr = tr.replace(/#{price}/g, list[i].price)
								tr = tr.replace(/#{num}/g, list[i].num)
								let subPrice = (list[i].price * list[i].num).toString()
								tr = tr.replace(/#{subPrice}/g, subPrice)
								$("#"+tbId).append(tr)
							}
						} else{
							confirm(json.state + ": " + json.message)
						}
					},
					error: function (xhr){
						error(xhr)
					}
				})
			}
		</script>
	</body>

</html>